<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CraftLand | Quiz</title>
    <link rel="stylesheet" href="CSS/quiz.css">
    <link rel="shortcut icon" href="./assets/imgs/logo mine.png" type="image/x-icon">
</head>

<body>

    <div id="quiz">
        <div id="containerPerguntas"></div>
        <br>
        <button class="btn btn-outline-secondaryQuiz" id="enviar">Enviar</button>
        <button class="btn btn-outline-secondaryQuiz" id="proximaFase" style="display: none;">Proxima Fase</button>
    </div>

    <div id="resultado"></div>

    <script>
        // Array de perguntas divididas em duas fases
        const perguntasFase1 = [
            "Quem é o criador original do jogo Minecraft?",
            "Qual empresa desenvolveu e publicou o Minecraft originalmente?",
            "Qual foi o ano em que a Microsoft adquiriu os direitos de propriedade intelectual do Minecraft?",
            "Em que tipo de mundo os jogadores exploram no Minecraft?",
            "Qual é o modo de jogo onde os jogadores precisam obter recursos para construir e sobreviver?"
        ];

        const perguntasFase2 = [
            "O que os jogadores podem fazer no modo criativo do Minecraft?",
            "O que os jogadores da versão Java do Minecraft podem fazer com módulos?",
            "Qual evento de game jam a Mojang colaborou para angariar fundos para caridade?",
            "Em que ano a Mojang anunciou publicamente sua aquisição pela Microsoft?",
            "Qual é um dos objetivos principais do Minecraft Education?"
        ];

        // Opções para cada pergunta
        const opcoesFase1 = [
            ["Markus 'Notch' Persson", "Carl Manneh", "Rolf Jansson", "Jakob Porser"],
            ["Valve Corporation", "Mojang Studios", "Microsoft Studios", "Blizzard Entertainment"],
            ["2009", "2011", "2014", "2015"],
            ["Bidimensional", "Tridimensional", "Unidimensional", "Quadrilateral"],
            ["Modo de Aventura", "Modo Criativo", "Modo Hardcore", "Modo de Sobrevivência"],
        ];

        const opcoesFase2 = [
            ["Lutar contra inimigos controlados por computador", "Obter recursos limitados para construir", "Ter recursos ilimitados para construir", "Competir com outros jogadores"],
            ["Criar novas texturas", "Modificar a jogabilidade", "Gerar novos mundos", "Desbloquear personagens especiais"],
            ["Mojam 1", "Mojam 2", "Mojang Jam", "Catacomb Snatch"],
            ["2012", "2014", "2016", "2018"],
            ["Desenvolver habilidades para competições esportivas", "Promover o aprendizado criativo e inclusivo", "Treinar habilidades de marketing digital", "Fomentar competições entre alunos."]
        ];

        // Respostas corretas para cada pergunta
        const respostasFase1 = [
            "Markus 'Notch' Persson",
            "Mojang Studios",
            "2014",
            "Tridimensional",
            "Modo de Sobrevivência",
        ];

        const respostasFase2 = [
            "Ter recursos ilimitados para construir",
            "Modificar a jogabilidade",
            "Mojam 1",
            "2014",
            "Promover o aprendizado criativo e inclusivo"
        ];

        // Referências aos elementos HTML
        const containerPerguntas = document.getElementById('containerPerguntas');
        const enviarButton = document.getElementById('enviar');
        const proximaFaseButton = document.getElementById('proximaFase');

        // Variáveis para armazenar o ID do usuário e as pontuações
        let idUsuario = sessionStorage.ID_USUARIO;
        let pontuacaoFase1 = 0;
        let pontuacaoFase2 = 0;
        let faseAtual = 1; // Variável para rastrear a fase atual do quiz
        let indicePerguntaAtual = 0; // Variável para rastrear o índice da próxima pergunta a ser exibida

        // Event listeners para os botões
        enviarButton.onclick = enviar;
        proximaFaseButton.onclick = proximaFase;

        // Função para exibir as próximas perguntas com base na fase atual
        function exibirPerguntas() {
            // Limpa o container de perguntas
            containerPerguntas.innerHTML = '';
            // Seleciona as perguntas e opções com base na fase atual
            const perguntas = faseAtual === 1 ? perguntasFase1 : perguntasFase2;
            const opcoes = faseAtual === 1 ? opcoesFase1 : opcoesFase2;

            // Exibe as próximas perguntas
            for (let i = indicePerguntaAtual; i < indicePerguntaAtual + 5; i++) {
                if (i < perguntas.length) {
                    const pergunta = perguntas[i];
                    const opcoesPergunta = opcoes[i];
                    const divPergunta = document.createElement('div');
                    divPergunta.innerHTML = `
                        <h2>${pergunta}</h2>
                        ${opcoesPergunta.map((opcao, indiceOpcao) => `
                            <input type="radio" name="pergunta${i}" value="${opcao}" id="pergunta${i}_opcao${indiceOpcao}">
                            <label for="pergunta${i}_opcao${indiceOpcao}">${opcao}</label><br>
                        `).join('')}
                        <div id="resultado2${i}"></div>
                    `;
                    containerPerguntas.appendChild(divPergunta);
                }
            }

            // Atualiza o índice da próxima pergunta
            indicePerguntaAtual += 5;
        }

        // Função para verificar as respostas da fase atual
        function verificarRespostas() {
            // Seleciona as respostas corretas com base na fase atual
            const respostas = faseAtual === 1 ? respostasFase1 : respostasFase2;
            let pontuacao = 0;
            let perguntasFase = faseAtual === 1 ? perguntasFase1 : perguntasFase2;

            // Verifica cada resposta
            perguntasFase.forEach((pergunta, indice) => {
                const opcaoSelecionada = document.querySelector(`input[name="pergunta${indicePerguntaAtual - 5 + indice}"]:checked`);
                const respostaContainer = document.getElementById(`resultado2${indicePerguntaAtual - 5 + indice}`);
                if (opcaoSelecionada && opcaoSelecionada.value === respostas[indice]) {
                    pontuacao++;
                    respostaContainer.innerText = "Correto!";
                    respostaContainer.style.color = "green";
                } else {
                    respostaContainer.innerText = "Incorreto!";
                    // respostaContainer.innerText = `Incorreto! A resposta correta é: ${respostas[indice]}`;
                    respostaContainer.style.color = "red";
                }
            });

            // Atualiza a pontuação da fase atual
            if (faseAtual === 1) {
                pontuacaoFase1 = pontuacao;
            } else {
                pontuacaoFase2 = pontuacao;
            }
        }

        // Função para enviar o resultado final ao servidor
        function enviarResultadoFinal() {
            fetch("/quiz/enviar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    fase1Server: pontuacaoFase1,
                    fase2Server: pontuacaoFase2,
                    totalServer: pontuacaoFase1 + pontuacaoFase2,
                    usuarioIdServer: idUsuario,
                })
            })
                .then(function (resposta) {
                    if (resposta.ok) {
                        resposta.json().then(json => {
                            sessionStorage.TOTAL_PONTUACAO = json.Total;
                            setTimeout(function () {
                                window.location = "dashboard.html";
                            }, 2000);
                        });
                    }
                }).catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
        }

        // Função para avançar para a próxima fase
        function proximaFase() {
            if (faseAtual === 1) {
                // Se estiver na fase 1, avança para a fase 2
                faseAtual = 2;
                indicePerguntaAtual = 0;
                proximaFaseButton.style.display = "none";
                enviarButton.style.display = "block";
                exibirPerguntas();
            } else {
                // Se estiver na fase 2, envia o resultado final
                enviarResultadoFinal();
            }
        }

        // Função de envio/avanço de fase
        function enviar() {
            verificarRespostas();
            // Se todas as perguntas da fase atual foram respondidas, exibe o botão "Próxima Fase"
            if (faseAtual === 1 && indicePerguntaAtual >= perguntasFase1.length) {
                enviarButton.style.display = "none";
                proximaFaseButton.style.display = "block";
            } else if (faseAtual === 2 && indicePerguntaAtual >= perguntasFase2.length) {
                enviarButton.style.display = "none";
                proximaFaseButton.innerText = "Finalizar";
                proximaFaseButton.style.display = "block";
            } else {
                exibirPerguntas();
            }
            return false;
        }

        // Exibe as primeiras perguntas da fase 1
        exibirPerguntas();

    </script>

</body>

</html>