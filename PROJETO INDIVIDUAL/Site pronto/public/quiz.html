<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CraftLand | Quiz</title>
    <link rel="stylesheet" href="CSS/style.css">
    <link rel="shortcut icon" href="./imgs/logo mine.png" type="image/x-icon">
</head>

<body id="bodyQuiz">

    <div id="quiz">
        <div id="containerPerguntas"></div>
        <br>
        <button class="btn btn-outline-secondaryQuiz" id="enviar">Enviar</button>
    </div>

    <div id="resultado"></div>

    <script>
        // Array de perguntas divididas em duas fases

        const perguntasFase1 = [
            "Quem é o criador original do jogo Minecraft?",
            "Qual empresa desenvolveu e publicou o Minecraft originalmente?",
            "Qual foi o ano em que a Microsoft adquiriu os direitos de propriedade intelectual do Minecraft?",
            "Em que tipo de mundo os jogadores exploram no Minecraft?",
            "Qual é o modo de jogo onde os jogadores precisam obter recursos para construir e sobreviver?"
        ];

        const perguntasFase2 = [
            "O que os jogadores podem fazer no modo criativo do Minecraft?",
            "O que os jogadores da versão Java do Minecraft podem fazer com módulos?",
            "Qual evento de game jam a Mojang colaborou para angariar fundos para caridade?",
            "Em que ano a Mojang anunciou publicamente sua aquisição pela Microsoft?",
            "Qual é um dos objetivos principais do Minecraft Education?"
        ];

        // Opções para cada pergunta
        const opcoesFase1 = [
            ["Markus 'Notch' Persson", "Carl Manneh", "Rolf Jansson", "Jakob Porser"],
            ["Valve Corporation", "Mojang Studios", "Microsoft Studios", "Blizzard Entertainment"],
            ["2009", "2011", "2014", "2015"],
            ["Bidimensional", "Tridimensional", "Unidimensional", "Quadrilateral"],
            ["Modo de Aventura", "Modo Criativo", "Modo Hardcore", "Modo de Sobrevivência"],
        ];

        const opcoesFase2 = [
            ["Lutar contra inimigos controlados por computador", "Obter recursos limitados para construir", "Ter recursos ilimitados para construir", "Competir com outros jogadores"],
            ["Criar novas texturas", "Modificar a jogabilidade", "Gerar novos mundos", "Desbloquear personagens especiais"],
            ["Mojam 1", "Mojam 2", "Mojang Jam", "Catacomb Snatch"],
            ["2012", "2014", "2016", "2018"],
            ["Desenvolver habilidades para competições esportivas", "Promover o aprendizado criativo e inclusivo", "Treinar habilidades de marketing digital", "Fomentar competições entre alunos."]
        ];

        // Respostas corretas para cada pergunta
        const respostasFase1 = [
            "Markus 'Notch' Persson",
            "Mojang Studios",
            "2014",
            "Tridimensional",
            "Modo de Sobrevivência",
        ];

        const respostasFase2 = [
            "Ter recursos ilimitados para construir",
            "Modificar a jogabilidade",
            "Mojam 1",
            "2014",
            "Promover o aprendizado criativo e inclusivo"
        ];

        const containerQuiz = document.getElementById('quiz');
        const containerResultado = document.getElementById('resultado');
        document.getElementById('enviar').onclick = enviar;
        const containerPerguntas = document.getElementById('containerPerguntas');

        let idUsuario = sessionStorage.ID_USUARIO;
        let pontuacaoFase1 = 0; // Variável para armazenar a pontuação da fase 1 do usuário
        let pontuacaoFase2 = 0; // Variável para armazenar a pontuação da fase 2 do usuário
        let faseAtual = 1; // Variável para rastrear a fase atual do quiz
        let indicePerguntaAtual = 0; // Variável para rastrear o índice da próxima pergunta a ser exibida

        // Função para exibir as próximas perguntas com base na fase atual
        function exibirPerguntas() {
            // Limpa o container de perguntas
            containerPerguntas.innerHTML = '';

            // Seleciona as perguntas e opções com base na fase atual
            const perguntas = faseAtual === 1 ? perguntasFase1 : perguntasFase2;
            const opcoes = faseAtual === 1 ? opcoesFase1 : opcoesFase2;

            // Exibe as próximas perguntas
            for (let i = indicePerguntaAtual; i < indicePerguntaAtual + 5; i++) {
                if (i < perguntas.length) {
                    const pergunta = perguntas[i];
                    const opcoesPergunta = opcoes[i];

                    const divPergunta = document.createElement('div');
                    divPergunta.innerHTML = `
            <h2>${pergunta}</h2>
            ${opcoesPergunta.map((opcao, indiceOpcao) => `
              <input type="radio" name="pergunta${i}" value="${opcao}" id="pergunta${i}_opcao${indiceOpcao}">
              <label for="pergunta${i}_opcao${indiceOpcao}">${opcao}</label><br>
            `).join('')}
            <div id="resultado2${i}"></div>
          `;
                    containerPerguntas.appendChild(divPergunta);
                }
            }

            // Atualiza o índice da próxima pergunta
            indicePerguntaAtual += 5;
        }

        // Função para verificar as respostas da fase atual e avançar para a próxima fase ou mostrar o resultado final
        function verificarRespostas() {
            const respostas = faseAtual === 1 ? respostasFase1 : respostasFase2;
            let pontuacao;
            let perguntasFase;

            if (faseAtual === 1) {
                pontuacao = pontuacaoFase1;
                perguntasFase = perguntasFase1;
            } else {
                pontuacao = pontuacaoFase2;
                perguntasFase = perguntasFase2;
            }

            perguntasFase.forEach((pergunta, indice) => {
                const opcaoSelecionada = document.querySelector(`input[name="pergunta${indicePerguntaAtual - 5 + indice}"]:checked`);
                const respostaContainer = document.getElementById(`resultado2${indicePerguntaAtual - 5 + indice}`);
                if (opcaoSelecionada && opcaoSelecionada.value === respostas[indice]) {
                    pontuacao++;
                    respostaContainer.innerText = "Correto!";
                    respostaContainer.style.color = "green";
                } else {
                    respostaContainer.innerText = "Incorreto!";
                    respostaContainer.style.color = "red";
                }
            });

            // Mostra as respostas corretas e incorretas por 7 segundos antes de avançar
            setTimeout(() => {
                // Se for a primeira fase, avança para a segunda fase, senão, mostra o resultado final
                if (faseAtual === 1) {
                    pontuacaoFase1 = pontuacao;
                    faseAtual = 2;
                    indicePerguntaAtual = 0;
                    exibirPerguntas();
                } else {
                    pontuacaoFase2 = pontuacao;
                    // Chama o fetch apenas após a segunda fase
                    fetch("/quiz/enviar", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            fase1Server: pontuacaoFase1,
                            fase2Server: pontuacaoFase2,
                            totalServer: pontuacaoFase1 + pontuacaoFase2,
                            usuarioIdServer: idUsuario,

                        })
                    })
                        .then(function (resposta) {
                            console.log("resposta: ", resposta);

                            if (resposta.ok) {

                                setTimeout(() => {
                                    window.location = "dashboard.html";
                                }, "2000");

                            }
                        })
                        .catch(function (resposta) {
                            console.log(`#ERRO: ${resposta}`);
                        });
                }
            }, 7000); // 7 segundos de tempo de exibição
        }

        // Event listener para o botão de enviar
        function enviar() {
            if (indicePerguntaAtual < perguntasFase1.length && faseAtual === 1) {
                exibirPerguntas(); // Exibe as próximas perguntas da fase 1
            } else if (indicePerguntaAtual < perguntasFase2.length && faseAtual === 2) {
                exibirPerguntas(); // Exibe as próximas perguntas da fase 2
            } else {
                verificarRespostas(); // Verifica as respostas e mostra o resultado final
            }

            return false;
        };

        // Exibe as primeiras perguntas da fase 1
        exibirPerguntas();


    </script>

</body>

</html>